$(document).foundation(),$(function(){var t=function(){this.search=$("#search-input"),this.toTop=$(".back-to-top"),this.loginBtn=$("#login"),this.registerBtn=$("#register"),this.search=$("#search-input")};t.prototype.bindEvent=function(){var t=this;this.search.on("keydown",function(t){var t=t||window.event,e=$("#search-input").val();13===t.which&&(location.href="/search?tag="+encodeURIComponent(e))}),this.loginBtn.on("click",function(e){var n=$(".login-name").val(),i=$(".login-psw").val();return 0==n.length||0==i.length?($(".login-tip").html("用户名和密码不能为空!"),!1):void(i.length<6?$(".login-tip").html("密码长度不得小于6!"):$.post("/user",{username:n,password:i},function(e,n){if("error"==n||"timeout"==n)$(".login-tip").html("用户名或密码错误!");else if(e.status&&($("#login").off("click"),t.registerBtn.off("click"),$("#login-modal").foundation("close"),$("#bar-login").replaceWith('<li><a href="/user/'+e.sessiondata.username+'">'+e.sessiondata.username+"</a></li>"),$("#bar-register").replaceWith('<li><a href="" id="bar-logout">退出</a></li>'),window.sessionStorage)){var i=e.sessiondata.nickname||e.sessiondata.username,o=e.sessiondata.avator;sessionStorage.setItem("name",i),sessionStorage.setItem("avator",o)}}))}),$(".top-bar-right").on("click","#bar-logout",function(t){$.post("/user/authenticate/logout",function(t){t.status&&(sessionStorage.clear(),location.reload())})}),this.registerBtn.on("click",function(){var t=$(".reg-name").val(),e=$(".reg-psw").val(),n=$(".reg-psw-again").val(),i=$('#register-form input[name="gender"]:checked').val();return""==t||0==e.length?($(".register-tip").html("用户名和密码不能为空"),!1):e.length<6?($(".register-tip").html("密码长度不得小于6"),!1):e!==n?($(".register-tip").html("密码前后不一致"),!1):void $.post("/user/authenticate/register",{username:t,password:e,gender:i},function(t){t.status?$("#login-modal").foundation("open"):$(".register-tip").html(t.info)})}),$(".reg-psw-again").on("blur",function(){$(this).val()!==$(".reg-psw").val()&&$(".register-tip").html("密码前后不一致")}),this.toTop.on("click",function(t){t.preventDefault(),document.body.scrollTop=0})},t.prototype.loaded=function(){$(document).ready(function(){document.getElementById("loading").style.display="none"})},t.prototype.init=function(){this.bindEvent(),this.loaded()},(new t).init()});